
> st-sample-project@0.1.0 test
> DOTENV_CONFIG_PATH=.env jest --setupFiles dotenv/config  --forceExit && node db-cleanup.js

[dotenv@17.2.3] injecting env (8) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops
(node:19) [DEP0040] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
(node:172) Warning: `--localstorage-file` was provided without a valid path
(Use `node --trace-warnings ...` to show where the warning was created)
PASS __tests__/app/app.instrumentation.test.js
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

(node:168) Warning: `--localstorage-file` was provided without a valid path
(Use `node --trace-warnings ...` to show where the warning was created)
PASS __tests__/app/app.performance.test.js
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

(node:160) [DEP0040] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
(node:155) [DEP0040] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
(node:155) [MONGOOSE] DeprecationWarning: Mongoose: the `strictQuery` option will be switched back to `false` by default in Mongoose 7. Use `mongoose.set('strictQuery', false);` if you want to prepare for this change. Or use `mongoose.set('strictQuery', true);` to suppress this warning.
(node:160) Warning: `--localstorage-file` was provided without a valid path
PASS __tests__/app/app.unit.test.js
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

(node:155) Warning: `--localstorage-file` was provided without a valid path
PASS __tests__/db/db.test.js
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

(node:148) Warning: `--localstorage-file` was provided without a valid path
(Use `node --trace-warnings ...` to show where the warning was created)
PASS __tests__/api/api.users-admin.test.js
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

(node:141) Warning: `--localstorage-file` was provided without a valid path
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL __tests__/api/api.robustness.test.js
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  ‚óè Robustness and Error Handling Tests ‚Ä∫ Invalid Resource IDs ‚Ä∫ should return 404 for non-existent user deletion with valid ObjectID

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 400

      112 |         headers: { Authorization: `Bearer ${adminToken}` }
      113 |       }).catch((error) => {
    > 114 |         expect(error.response.status).toBe(404);
          |                                       ^
      115 |       });
      116 |     });
      117 |   });

      at toBe (__tests__/api/api.robustness.test.js:114:39)
      at Object.<anonymous> (__tests__/api/api.robustness.test.js:111:7)

(node:143) Warning: `--localstorage-file` was provided without a valid path
(Use `node --trace-warnings ...` to show where the warning was created)
PASS __tests__/api/api.validation.test.js
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

(node:128) Warning: `--localstorage-file` was provided without a valid path
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL __tests__/api/api.security.test.js
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  ‚óè Security and Authorization Tests ‚Ä∫ Password Security ‚Ä∫ should not expose password in user profile response

    expect(received).toBeUndefined()

    Received: "$2b$08$Nquk6S77hL/GGqAwKVkLkebrxqEvKEaQ7tzJLl0C.cH7yqFR.sLzO"

      190 |       });
      191 |
    > 192 |       expect(profile.data.password).toBeUndefined();
          |                                     ^
      193 |       expect(profile.data.hashedPassword).toBeUndefined();
      194 |     });
      195 |   });

      at Object.toBeUndefined (__tests__/api/api.security.test.js:192:37)

(node:129) Warning: `--localstorage-file` was provided without a valid path
(Use `node --trace-warnings ...` to show where the warning was created)
PASS __tests__/api/api.users-generic.test.js
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (node_modules/dotenv/lib/main.js:142:11)

(node:135) Warning: `--localstorage-file` was provided without a valid path
(Use `node --trace-warnings ...` to show where the warning was created)
PASS __tests__/api/api.users-simple.test.js
  ‚óè Console

    console.log
      [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)


Test Suites: 2 failed, 8 passed, 10 total
Tests:       2 failed, 89 passed, 91 total
Snapshots:   0 total
Time:        2.087 s
Ran all test suites.
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
Force exiting Jest: Have you considered using `--detectOpenHandles` to detect async operations that kept running after all tests finished?
